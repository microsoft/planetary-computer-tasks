id: met-office
image: ${{ args.registry }}/pctasks-task-base:2026.01.12

args:
  - registry

code:
  src: ${{ local.path(./met_office.py) }}
  requirements: ${{ local.path(./requirements.txt) }}

environment:
  APPLICATIONINSIGHTS_CONNECTION_STRING: ${{ secrets.task-application-insights-connection-string }}

collections:
  - id: met-office-global-deterministic-height
    template: ${{ local.path(./collection/met-office-global-deterministic-height) }}
    class: met_office:MetOfficeGlobalHeightCollection
    asset_storage:
      # "global/whole-atmosphere/update/2025/10/23/1200Z/20251023T1200Z-PT0000H00M.updated"
      - uri: blob://ukmoeuwest/deterministic/global/height/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-global-deterministic-height
  - id: met-office-global-deterministic-near-surface
    template: ${{ local.path(./collection/met-office-global-deterministic-near-surface) }}
    class: met_office:MetOfficeGlobalNearSurfaceCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/global/near-surface/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-global-deterministic-near-surface
  - id: met-office-global-deterministic-pressure
    template: ${{ local.path(./collection/met-office-global-deterministic-pressure) }}
    class: met_office:MetOfficeGlobalPressureCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/global/pressure/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-global-deterministic-pressure
  - id: met-office-global-deterministic-whole-atmosphere
    template: ${{ local.path(./collection/met-office-global-deterministic-whole-atmosphere) }}
    class: met_office:MetOfficeGlobalWholeAtmosphereCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/global/whole-atmosphere/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-global-deterministic-whole-atmosphere
  - id: met-office-uk-deterministic-height
    template: ${{ local.path(./collection/met-office-uk-deterministic-height) }}
    class: met_office:MetOfficeUkHeightCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/uk/height/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-uk-deterministic-height
  - id: met-office-uk-deterministic-near-surface
    template: ${{ local.path(./collection/met-office-uk-deterministic-near-surface) }}
    class: met_office:MetOfficeUkNearSurfaceCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/uk/near-surface/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-uk-deterministic-near-surface
  - id: met-office-uk-deterministic-pressure
    template: ${{ local.path(./collection/met-office-uk-deterministic-pressure) }}
    class: met_office:MetOfficeUkPressureCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/uk/pressure/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-uk-deterministic-near-surface
  - id: met-office-uk-deterministic-whole-atmosphere
    template: ${{ local.path(./collection/met-office-uk-deterministic-whole-atmosphere) }}
    class: met_office:MetOfficeUkWholeAtmosphereCollection
    asset_storage:
      - uri: blob://ukmoeuwest/deterministic/uk/whole-atmosphere/update
        chunks:
          splits:
            - depth: 3
          options:
            min_depth: 1
            max_depth: 1
            extensions:
              - .updated
            chunk_length: 20000
    chunk_storage:
      uri: blob://ukmoeuwest/chunks/met-office-uk-deterministic-near-surface
